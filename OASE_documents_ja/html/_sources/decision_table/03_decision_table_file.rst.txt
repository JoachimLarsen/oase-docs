==============================================
3 OASE ディシジョンテーブルファイルの説明
==============================================

本章では、ディシジョンテーブルファイルについて説明します。

3.1 ディシジョンテーブルファイルとは
======================================
* ディシジョンテーブル画面でディシジョンテーブルを登録したうえで、ダウンロードしたディシジョンテーブルファイルを編集しルール画面にアップロードすることで、テストリクエストおよびルールマッチング結果によるアクションの実行を行うことができます。
* ディシジョンテーブルファイルでは、実行されるアクションについて条件を設定できます。



(1)Tablesシート全体
--------------------

テストリクエストおよびルールマッチング結果によるアクションの実行を行うため、ディシジョンテーブルファイルのTablesシートに判定の基準となる条件を記述する必要があります。

.. figure:: ../images/decision_table/decision_table_29.png
   :scale: 100%
   :align: center

   図 3.1-1-1 ディシジョンテーブル新規追加画面


.. figure:: ../images/decision_table/decision_table_20.png
   :scale: 100%
   :align: center

   図 3.1-1-2 ディシジョンテーブルファイル(Tablesシート)


.. csv-table:: 表 3.1-1-2 機能説明
   :header: No., 構成要素, 説明
   :widths: 5, 20, 60

   1, ファイル名(RuleTable名),ディシジョンテーブル画面で新規追加および複製時に入力したRuleTable名は生成されるエクセルファイルのファイル名になります。
   2, コメント部,ダウンロードしたエクセルファイルの背景色緑色の箇所です。
   3, 条件部(条件式),ディシジョンテーブル画面で新規追加および複製時に入力した条件式は生成されるエクセルファイルの条件部（背景色水色箇所）になります。
   4, アクション部,ダウンロードしたエクセルファイルの背景色黄色の箇所です。入力必須項目です。
   5, アクション条件部,ダウンロードしたエクセルファイルの背景色赤色の箇所です。


(2)コメント部
---------------------
* Tablesシートの背景色緑色の箇所です。

.. figure:: ../images/decision_table/decision_table_30.png
   :scale: 100%
   :align: center

   図 3.1-2-1 ディシジョンテーブルファイル(Tablesシート)のコメント部

| **ルール説明**

* 任意の文章を入力できます。ルール説明等に使うことが可能です。

**記述例**
::

  エラー001


(3)条件部
---------------------
* Tablesシートの背景色水色の箇所です。
* 記入方法は前述の :ref:`label_table_1` をご参照ください。

.. figure:: ../images/decision_table/decision_table_31.png
   :scale: 100%
   :align: center

   図 3.1-3-1 ディシジョンテーブルファイル(Tablesシート)の条件部

.. note::
       ディシジョンテーブル画面で新規追加および複製時に入力した"時間[HH:mm](From-to)"は、エクセルファイルでは"[HH:mm](from)"と"[HH:mm](to)"の2列に分かれます。開始日時と終了日時をそれぞれ入力して下さい。


(4)アクション部
---------------------
* Tablesシートの背景色黄色の箇所です。
* ルール名ごとにどのようなアクションを実行するか設定することができます。
* アクションを実行してよいか、実行する前に事前承認メールを送る設定をすることができます。
* アクションの実行が失敗した場合何回リトライするか、リトライの間隔および回数を設定することができます。
* 同一アクションを何度も実行するのを避けたい場合、抑止の間隔および回数を設定することで制御できます。
* アクション種別ごとに記入方法が異なる場合があります。設定内容に合わせて記入してください。

.. figure:: ../images/decision_table/decision_table_32.png
   :scale: 100%
   :align: center

   図 3.1-4-1 ディシジョンテーブルファイル(Tablesシート)の条件部

共通
^^^^^

| **ルール名（必須）**

* 一意となる名称を記入してください。

**記述例**

::
  
  rule1


| **アクション種別（必須）**

* 実行したいアクション種別をプルダウンで選択してください。

**記述例**

::
  
 mail(ver1)



| **アクションパラメータ情報（必須）※ダブルクオーテーションは使用不可**

記入方法は後述の :ref:`labelCap1` および :ref:`labelCap2` をご参照ください。

| **アクション実行前パラメータ情報（必須）※ダブルクオーテーションは使用不可 ※不要の場合は「X」を定義**

* MAIL_NAMEは必須です。OASE画面のシステム-アクション設定-mail_driverの名前と紐づけます。
* 「MAIL_TO=,MAIL_CC=,MAIL_BCC=」は送信したいメールアドレスを記述してください。
* 「MAIL_TEMPLATE=」はテンプレート名を記述してください。未記入の場合はデフォルトのメールが送信されます。
* 宛先やテンプレート名は空白でも良いですが、記述例のように、「MAIL_TO=,MAIL_CC=,MAIL_BCC=,MAIL_TEMPLATE=」の記述は必要です。また、MAIL_TOにメールアドレスの指定、またはMAIL_TEMPLATEで指定したテンプレートに宛先があること、のどちらかが必要です。
* 2つ以上、送信したいアドレスがある場合は「;」でつなげてください。
* MAIL_TEMPLATEはOASE画面のシステム-アクション設定-メールテンプレートのテンプレート名と紐づけます。
* 不要の場合はXを記述してください。



**記述例**

::

 MAIL_NAME=oasetest,MAIL_TO=aaa@aaa.com;bbb@bbb.com,MAIL_CC=ccc@ccc.com,MAIL_BCC=ddd@ddd.com,MAIL_TEMPLATE=test_template

::

 MAIL_NAME=oasetest,MAIL_TO=,MAIL_CC=,MAIL_BCC=,MAIL_TEMPLATE=

::
  
 X


  
| **アクションリトライ間隔（必須）※「1」以上を定義して下さい。**

* アクションのリトライ間隔を記述します。
* リトライ間隔の単位は秒になります。

**記述例**

::
  
 1



| **アクションリトライ回数（必須）※「1」以上を定義して下さい。**

* アクションのリトライ回数を記述します。

**記述例**

::
  
 1



| **アクション抑止間隔（必須）※「1」以上を定義して下さい。**

* アクションの抑止間隔を記述します。
* 抑止間隔の単位は秒になります。

**記述例**

::
  
 1



| **アクション抑止回数（必須）※「1」以上を定義して下さい。**

* アクションの抑止回数を記述します。

**記述例**

::
  
 1




.. _labelCap1:

ITAドライバ
^^^^^^^^^^^^^^

| **アクションパラメータ情報（必須）※ダブルクオーテーションは使用不可**

* ITA_NAMEはOASE画面のシステム-アクション設定-ITA_driverの名前と紐づけます。
* SYMPHONY_CLASS_IDはITA画面の基本コンソール-Symphonyクラス一覧のSymphonyクラスIDと紐づけます。
* OPERATION_IDはITA画面の基本コンソール-投入オペレーション一覧のオペレーションIDと紐づけます。

**記述例**

::

 ITA_NAME=action43,SYMPHONY_CLASS_ID=2,OPERATION_ID=10


.. _labelCap2:


mailドライバ
^^^^^^^^^^^^^^

| **アクションパラメータ情報（必須）※ダブルクオーテーションは使用不可**

* MAIL_NAMEは必須です。OASE画面のシステム-アクション設定-mail_driverの名前と紐づけます。
* 「MAIL_TO=,MAIL_CC=,MAIL_BCC=」は送信したいメールアドレスを記述してください。
* 「MAIL_TEMPLATE=」はテンプレート名を記述してください。
* 宛先やテンプレート名は空白でも良いですが、記述例のように、「MAIL_TO=,MAIL_CC=,MAIL_BCC=,AIL_TEMPLATE=」の記述は必要です。また、MAIL_TOにメールアドレスの指定、またはMAIL_TEMPLATEで指定したテンプレートに宛先があること、のどちらかが必要です。
* 2つ以上、送信したいアドレスがある場合は「;」でつなげてください。
* MAIL_TEMPLATEはOASE画面のシステム-アクション設定-メールテンプレートのテンプレート名と紐づけます。

**記述例**

::

 MAIL_NAME=oasetest,MAIL_TO=aaa@aaa.com;bbb@bbb.com,MAIL_CC=ccc@ccc.com,MAIL_BCC=ddd@ddd.com,MAIL_TEMPLATE=test_template

::

 MAIL_NAME=oasetest,MAIL_TO=,MAIL_CC=,MAIL_BCC=,MAIL_TEMPLATE=test_template


(5)アクション条件部
---------------------

*  Tablesシートの背景色赤色の箇所です。

.. figure:: ../images/decision_table/decision_table_33.png
   :scale: 100%
   :align: center

   図 3.3-5-1 ディシジョンテーブルファイル(Tablesシート)のアクション条件部

| **有効日**


* ルールの有効日を設定できます。
* 有効日を設定しない場合は空欄にします。
* yyyy-mm-dd形式で入力して下さい。

**記述例**

::

 2010-01-01

| **無効日**

* ルールの無効日を設定できます。
* 無効日を設定しない場合は空欄にします。
* yyyy-mm-dd形式で入力して下さい。

**記述例**

::

 2020-01-01



(6)記述例シート
---------------------

* ディシジョンテーブルファイルのTablesシートに記述すべき値の例が記載されたシートです。
* 項目によっては記述フォーマットについても例が記載されています。

.. figure:: ../images/decision_table/decision_table_34.png
   :scale: 100%
   :align: center

   図 3.1-6-1 ディシジョンテーブルファイル(記述例シート)
